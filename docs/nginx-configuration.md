# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Nginx –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞:
- **–ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`nginx.conf`) - –æ–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (`nginx/react.conf`) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è React SPA

## üîß –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (nginx.conf)

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `nginx` (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- **Worker –ø—Ä–æ—Ü–µ—Å—Å—ã**: `auto` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)
- **Worker connections**: 768
- **File descriptors**: 16384

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `nginx`
- ‚úÖ –¢–æ–ª—å–∫–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ SSL –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (TLSv1.2, TLSv1.3)
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ cipher suites
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ SSL session tickets
- ‚úÖ –í–∫–ª—é—á–µ–Ω SSL stapling

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –í–∫–ª—é—á–µ–Ω sendfile
- ‚úÖ TCP nopush
- ‚úÖ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ (open_file_cache)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã

### Rate Limiting

- ‚úÖ –û–±—â–∏–π –ª–∏–º–∏—Ç: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- ‚úÖ API –ª–∏–º–∏—Ç: 5 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫
- ‚úÖ –õ–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π: 10 –Ω–∞ IP

### Gzip

- ‚úÖ –í–∫–ª—é—á–µ–Ω–æ —Å–∂–∞—Ç–∏–µ
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞: 1000 –±–∞–π—Ç
- ‚úÖ –£—Ä–æ–≤–µ–Ω—å —Å–∂–∞—Ç–∏—è: 6
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤

## üéØ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (nginx/react.conf)

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **–ü–æ—Ä—Ç**: 443 (HTTPS), 80 (HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç)
- **HTTP/2**: –í–∫–ª—é—á–µ–Ω
- **Root**: `/usr/share/nginx/html`
- **Index**: `index.html`

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### Security Headers

```nginx
X-Frame-Options: SAMEORIGIN
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=(), camera=()
```

- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç clickjacking
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç MIME-sniffing
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å referrer policy
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ API –±—Ä–∞—É–∑–µ—Ä–∞

#### SSL/TLS

- ‚úÖ HTTP/2 –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã (TLSv1.2, TLSv1.3)
- ‚úÖ Let's Encrypt —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã

- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (jpg, png, svg, webp): 1 –≥–æ–¥
- **CSS/JS —Ñ–∞–π–ª—ã**: 1 –≥–æ–¥
- **–®—Ä–∏—Ñ—Ç—ã** (woff, woff2, ttf): 1 –≥–æ–¥
- **–î—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã** (pdf, doc –∏ —Ç.–¥.): 1 –Ω–µ–¥–µ–ª—è
- **index.html**: –ë–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)

#### –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```nginx
Cache-Control: public, immutable  # –î–ª—è —Å—Ç–∞—Ç–∏–∫–∏
Cache-Control: no-cache, no-store, must-revalidate  # –î–ª—è index.html
```

### SPA Routing

```nginx
location / {
    try_files $uri $uri/ /index.html;
}
```

–í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ `index.html` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã React Router.

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

- ‚úÖ Gzip —Å–∂–∞—Ç–∏–µ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∫—Ä—ã—Ç—ã–º —Ñ–∞–π–ª–∞–º
- ‚úÖ Health check endpoint (`/health`)

## üê≥ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Dockerfile.prod

```dockerfile
FROM nginx:stable-alpine

COPY --from=build-prod /app-prod/build /usr/share/nginx/html
COPY --from=build-prod /app-prod/nginx/react.conf /etc/nginx/conf.d/default.conf
COPY --from=build-prod /app-prod/nginx.conf /etc/nginx/nginx.conf
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞:
- `react.conf` ‚Üí `/etc/nginx/conf.d/default.conf`
- `nginx.conf` ‚Üí `/etc/nginx/nginx.conf`

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
docker run --rm -v $(pwd)/nginx.conf:/etc/nginx/nginx.conf:ro nginx:alpine nginx -t

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
docker run --rm -v $(pwd)/nginx/react.conf:/etc/nginx/conf.d/default.conf:ro nginx:alpine nginx -t
```

### –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it prod-mod sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -s reload
```

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ —Å–≤–æ–π –¥–æ–º–µ–Ω

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `nginx/react.conf.example` –≤ `nginx/react.conf`
2. –ó–∞–º–µ–Ω–∏—Ç–µ `your-domain.com` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (Let's Encrypt)
4. –û–±–Ω–æ–≤–∏—Ç–µ –ø—É—Ç–∏ –≤ Dockerfile –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose -f docker-compose.prod.yml up --build -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker-compose -f docker-compose.prod.yml logs -f
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose -f docker-compose.prod.yml stop

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# (–≤–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ nginx.conf –∏–ª–∏ nginx/react.conf)

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.prod.yml up --build -d
```

## üîê SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

### Let's Encrypt

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Certbot:

```bash
certbot certonly --nginx -d your-domain.com -d www.your-domain.com
```

–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –±—É–¥—É—Ç –≤:
- `/etc/letsencrypt/live/your-domain.com/fullchain.pem`
- `/etc/letsencrypt/live/your-domain.com/privkey.pem`

### –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab:

```bash
0 0 * * * certbot renew --quiet && docker-compose -f docker-compose.prod.yml restart
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# Access –ª–æ–≥
docker exec prod-mod tail -f /var/log/nginx/access.log

# Error –ª–æ–≥
docker exec prod-mod tail -f /var/log/nginx/error.log
```

### Health Check

```bash
curl https://your-domain.com/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: healthy
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü—É—Ç–∏**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç–∏ –≤ `react.conf` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤ Docker
2. **SSL**: –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (—á–µ—Ä–µ–∑ volumes)
3. **–ü—Ä–∞–≤–∞**: –§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é `nginx`
4. **Rate limiting**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ –≤–∞—à—É –Ω–∞–≥—Ä—É–∑–∫—É
5. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å—Ç–∞—Ç–∏–∫–∞ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Nginx Documentation](https://nginx.org/en/docs/)
- [Let's Encrypt](https://letsencrypt.org/)
- [SSL Labs Test](https://www.ssllabs.com/ssltest/) - –ø—Ä–æ–≤–µ—Ä–∫–∞ SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
