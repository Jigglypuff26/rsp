# Миграция на Vite

## Обзор

Проект был успешно мигрирован с Create React App (react-scripts) на Vite для более быстрой разработки и сборки.

## Изменения

### Добавленные файлы

- `vite.config.ts` - конфигурация Vite с настройками dev server, сборки и тестирования
- `tsconfig.node.json` - конфигурация TypeScript для Node.js окружения (для vite.config.ts)
- `index.html` - перенесен из `public/` в корень проекта (требование Vite)
- `src/vite-env.d.ts` - типы для Vite клиента
- `docs/vite-migration.md` - этот документ

### Удаленные файлы

- `src/react-app-env.d.ts` - заменен на `vite-env.d.ts`

### Измененные файлы

#### `package.json`
- **Удалены зависимости:**
  - `react-scripts` - заменен на Vite
  
- **Перемещены в devDependencies:**
  - Все testing библиотеки (`@testing-library/*`, `@types/*`)
  - `typescript` - обновлен до v5.7.3

- **Добавлены devDependencies:**
  - `vite` - сборщик
  - `@vitejs/plugin-react` - плагин для React
  - `vitest` - тестовый фреймворк (замена Jest)
  - `@vitest/ui` - UI для тестов
  - `jsdom` - DOM окружение для тестов

- **Обновлены скрипты:**
  - `start` → `dev` - запуск dev сервера через Vite
  - `build` - теперь использует `tsc && vite build`
  - `test` - теперь использует Vitest
  - Добавлен `preview` - предпросмотр production сборки

- **Удалено:**
  - `browserslist` - Vite использует современные браузеры по умолчанию

#### `tsconfig.json`
- Обновлен `target` с `es5` на `ES2020`
- Изменен `moduleResolution` на `bundler` (оптимизировано для Vite)
- Добавлены алиасы путей для FSD структуры
- Добавлены типы `vite/client` и `vitest/globals`
- Отключены `noUnusedLocals` и `noUnusedParameters` для более гибкой разработки

#### `.gitignore`
- Добавлен `/dist` - директория для production сборки Vite

#### Исходный код
- Удалены импорты `React` из всех файлов (не требуется с React 19 и JSX transform)
- Обновлены тесты для использования Vitest вместо Jest

## Конфигурация Vite

### Dev Server
- Порт: 3000
- Автоматическое открытие браузера при запуске

### Сборка
- Директория вывода: `build` (для совместимости с предыдущей конфигурацией)
- Source maps: включены

### Алиасы путей
Настроены алиасы для Feature-Sliced Design архитектуры:
- `@` → `./src`
- `app` → `./src/app`
- `entities` → `./src/entities`
- `features` → `./src/features`
- `pages` → `./src/pages`
- `shared` → `./src/shared`
- `widgets` → `./src/widgets`

### Тестирование
- Окружение: jsdom
- Глобальные переменные теста доступны без импорта
- Setup файл: `./src/setupTests.ts`
- CSS: включена поддержка

## Команды

### Разработка
```bash
npm run dev
```
Запускает dev сервер на http://localhost:3000

### Сборка
```bash
npm run build
```
Создает production сборку в директории `build/`

### Предпросмотр
```bash
npm run preview
```
Запускает локальный сервер для предпросмотра production сборки

### Тестирование
```bash
npm run test
```
Запускает тесты в watch режиме с Vitest

## Преимущества миграции

1. **Скорость разработки** - Vite использует нативные ES модули и HMR, что обеспечивает мгновенный запуск сервера
2. **Быстрая сборка** - Vite использует esbuild для pre-bundling, что в разы быстрее webpack
3. **Современные стандарты** - TypeScript 5.7, ES2020
4. **Лучший DX** - более быстрая обратная связь при разработке
5. **Меньше зависимостей** - удалено 1085 пакетов из node_modules

## Обратная совместимость

- Структура проекта осталась без изменений
- FSD архитектура полностью поддерживается
- Все существующие компоненты и тесты работают без изменений
- Production сборка создается в той же директории `build/`

## Возможные проблемы

1. **Переменные окружения** - Vite использует `import.meta.env` вместо `process.env`
   - Префикс для публичных переменных: `VITE_` (вместо `REACT_APP_`)
   
2. **Импорт assets** - все работает так же, но можно использовать `?url`, `?raw` и другие суффиксы для специальной обработки

3. **Global типы** - некоторые глобальные типы из CRA могут отсутствовать, при необходимости добавьте их в `vite-env.d.ts`

## Дальнейшие улучшения

- Настроить переменные окружения для разных режимов (`.env.development`, `.env.production`)
- Добавить Vitest UI для интерактивного тестирования
- Настроить code splitting для оптимизации размера бандла
- Добавить PWA поддержку с помощью `vite-plugin-pwa`
